<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>اسکن کیو آر کد و نمایش اطلاعات</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
  <style>
    #reader {
      width: 320px;
      margin: 20px auto;
    }
    #result {
      margin-top: 20px;
      text-align: right;
      font-size: 18px;
      direction: rtl;
      width: 320px;
      margin-left: auto;
      margin-right: auto;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      background-color: #f9f9f9;
      min-height: 120px;
    }
  </style>
</head>
<body>

<h2 style="text-align:center;">دوربین را باز کن و کیو آر کد را اسکن کن</h2>

<div id="reader"></div>
<div id="result">در حال بارگذاری...</div>

<script>
window.onload = function() {
  const jsonUrl = "https://raw.githubusercontent.com/sarvari1378/QRCode_Resolver/main/Data/Users.json";
  let users = [];

  fetch(jsonUrl)
    .then(res => {
      if (!res.ok) throw new Error("خطا در بارگذاری JSON");
      return res.json();
    })
    .then(data => {
      users = data;
      startScanner();
    })
    .catch(err => {
      document.getElementById("result").innerText = "خطا در بارگذاری داده‌ها: " + err.message;
    });

  let html5QrcodeScanner = null;

  function onScanSuccess(decodedText) {
    const user = users.find(u => String(u.id) === String(decodedText));
    if (user) {
      let html = "<h3>اطلاعات کاربر:</h3><ul>";
      for (const [k, v] of Object.entries(user)) {
        html += `<li><b>${k}:</b> ${v || ""}</li>`;
      }
      html += "</ul>";
      document.getElementById("result").innerHTML = html;
    } else {
      document.getElementById("result").innerHTML = `<p>کاربر با شناسه <b>${decodedText}</b> یافت نشد.</p>`;
    }
  }

  function onScanFailure(error) {
    // خطاهای اسکن رو می‌تونید اینجا ثبت کنید یا نادیده بگیرید
  }

  function startScanner() {
    html5QrcodeScanner = new Html5Qrcode("reader");

    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length) {
        const cameraId = cameras[0].id;
        html5QrcodeScanner.start(
          cameraId,
          { fps: 10, qrbox: 250 },
          onScanSuccess,
          onScanFailure
        );
      } else {
        document.getElementById("result").innerText = "دوربینی یافت نشد.";
      }
    }).catch(err => {
      document.getElementById("result").innerText = "دسترسی به دوربین امکان‌پذیر نیست.";
    });
  }
};
</script>

</body>
</html>
